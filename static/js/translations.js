// Translations for the Research Tool
const translations = {
    // English translations (default)
    'en': {
        // Common UI elements
        'app_name': 'AI Research Tool',
        'dashboard': 'Dashboard',
        'sources': 'Sources',
        'settings': 'Settings',
        'chat': 'Chat',
        'loading': 'Loading...',
        'save': 'Save',
        'cancel': 'Cancel',
        'reset': 'Reset',
        'search': 'Search',
        'more': 'More',
        'less': 'Less',
        'success': 'Success',
        'error': 'Error',
        'warning': 'Warning',
        'info': 'Information',
        
        // Settings page
        'general_settings': 'General Settings',
        'source_settings': 'Source Settings',
        'api_keys': 'API Keys',
        'notifications': 'Notifications',
        'export_settings': 'Export Settings',
        'advanced_settings': 'Advanced Settings',
        'application_theme': 'Application Theme',
        'language': 'Language',
        'date_format': 'Date Format',
        'enable_auto_refresh': 'Enable auto-refresh for data (every 30 minutes)',
        'save_settings': 'Save Settings',
        'reset_all': 'Reset All',
        'theme_light': 'Light',
        'theme_dark': 'Dark',
        'theme_system': 'System Default',
        'reset_confirm': 'Are you sure you want to reset all settings to default values? This cannot be undone.',
        'settings_saved': 'Settings saved successfully!',
        'all_settings_reset': 'All settings have been reset to defaults',
        
        // Dashboard
        'recent_articles': 'Recent Articles',
        'top_keywords': 'Top Keywords',
        'trending_topics': 'Trending Topics',
        'source_statistics': 'Source Statistics',
        'refresh_data': 'Refresh Data',
        'last_updated': 'Last updated',
        'no_articles': 'No articles found. Try selecting different sources.',
        
        // Sources page
        'select_sources': 'Select Sources',
        'fetch_data': 'Fetch Data',
        'arxiv_settings': 'ArXiv Settings',
        'category': 'Category',
        'max_articles': 'Max Articles',
        'citation_styles': 'Citation Styles',
        'results': 'Results',
        'status': 'Status',
        'no_sources_selected': 'Please select at least one source.',
        'fetching_data': 'Fetching data, please wait...',
        'data_fetched': 'Data fetched successfully',
        
        // Chat
        'type_message': 'Type your message...',
        'send': 'Send',
        'clear_chat': 'Clear Chat',
        'export_chat': 'Export',
        'ai_welcome': 'Hello! I\'m your AI research assistant. I can help you analyze research papers, find connections between concepts, summarize articles, and answer questions about the content in your research database.'
    },
    
    // German translations
    'de': {
        // Common UI elements
        'app_name': 'KI-Recherche-Tool',
        'dashboard': 'Dashboard',
        'sources': 'Quellen',
        'settings': 'Einstellungen',
        'chat': 'Chat',
        'loading': 'Lädt...',
        'save': 'Speichern',
        'cancel': 'Abbrechen',
        'reset': 'Zurücksetzen',
        'search': 'Suchen',
        'more': 'Mehr',
        'less': 'Weniger',
        'success': 'Erfolg',
        'error': 'Fehler',
        'warning': 'Warnung',
        'info': 'Information',
        
        // Settings page
        'general_settings': 'Allgemeine Einstellungen',
        'source_settings': 'Quellen-Einstellungen',
        'api_keys': 'API-Schlüssel',
        'notifications': 'Benachrichtigungen',
        'export_settings': 'Export-Einstellungen',
        'advanced_settings': 'Erweiterte Einstellungen',
        'application_theme': 'Anwendungsdesign',
        'language': 'Sprache',
        'date_format': 'Datumsformat',
        'enable_auto_refresh': 'Auto-Aktualisierung aktivieren (alle 30 Minuten)',
        'save_settings': 'Einstellungen speichern',
        'reset_all': 'Alles zurücksetzen',
        'theme_light': 'Hell',
        'theme_dark': 'Dunkel',
        'theme_system': 'Systemstandard',
        'reset_confirm': 'Sind Sie sicher, dass Sie alle Einstellungen auf die Standardwerte zurücksetzen möchten? Diese Aktion kann nicht rückgängig gemacht werden.',
        'settings_saved': 'Einstellungen erfolgreich gespeichert!',
        'all_settings_reset': 'Alle Einstellungen wurden auf die Standardwerte zurückgesetzt',
        
        // Dashboard
        'recent_articles': 'Aktuelle Artikel',
        'top_keywords': 'Top-Schlüsselwörter',
        'trending_topics': 'Trendthemen',
        'source_statistics': 'Quellenstatistik',
        'refresh_data': 'Daten aktualisieren',
        'last_updated': 'Zuletzt aktualisiert',
        'no_articles': 'Keine Artikel gefunden. Versuchen Sie, andere Quellen auszuwählen.',
        
        // Sources page
        'select_sources': 'Quellen auswählen',
        'fetch_data': 'Daten abrufen',
        'arxiv_settings': 'ArXiv-Einstellungen',
        'category': 'Kategorie',
        'max_articles': 'Maximale Artikel',
        'citation_styles': 'Zitationsstile',
        'results': 'Ergebnisse',
        'status': 'Status',
        'no_sources_selected': 'Bitte wählen Sie mindestens eine Quelle aus.',
        'fetching_data': 'Daten werden abgerufen, bitte warten...',
        'data_fetched': 'Daten erfolgreich abgerufen',
        
        // Chat
        'type_message': 'Nachricht eingeben...',
        'send': 'Senden',
        'clear_chat': 'Chat löschen',
        'export_chat': 'Exportieren',
        'ai_welcome': 'Hallo! Ich bin Ihr KI-Forschungsassistent. Ich kann Ihnen helfen, Forschungsarbeiten zu analysieren, Verbindungen zwischen Konzepten zu finden, Artikel zusammenzufassen und Fragen zu den Inhalten Ihrer Forschungsdatenbank zu beantworten.'
    },
    
    // French translations
    'fr': {
        // Common UI elements
        'app_name': 'Outil de Recherche IA',
        'dashboard': 'Tableau de bord',
        'sources': 'Sources',
        'settings': 'Paramètres',
        'chat': 'Discussion',
        'loading': 'Chargement...',
        'save': 'Enregistrer',
        'cancel': 'Annuler',
        'reset': 'Réinitialiser',
        'search': 'Rechercher',
        'more': 'Plus',
        'less': 'Moins',
        'success': 'Succès',
        'error': 'Erreur',
        'warning': 'Avertissement',
        'info': 'Information',
        
        // Settings page
        'general_settings': 'Paramètres généraux',
        'source_settings': 'Paramètres des sources',
        'api_keys': 'Clés API',
        'notifications': 'Notifications',
        'export_settings': 'Paramètres d\'exportation',
        'advanced_settings': 'Paramètres avancés',
        'application_theme': 'Thème de l\'application',
        'language': 'Langue',
        'date_format': 'Format de date',
        'enable_auto_refresh': 'Activer l\'actualisation automatique (toutes les 30 minutes)',
        'save_settings': 'Enregistrer les paramètres',
        'reset_all': 'Tout réinitialiser',
        'theme_light': 'Clair',
        'theme_dark': 'Sombre',
        'theme_system': 'Défaut du système',
        'reset_confirm': 'Êtes-vous sûr de vouloir réinitialiser tous les paramètres aux valeurs par défaut ? Cette action ne peut pas être annulée.',
        'settings_saved': 'Paramètres enregistrés avec succès !',
        'all_settings_reset': 'Tous les paramètres ont été réinitialisés aux valeurs par défaut',
        
        // Dashboard
        'recent_articles': 'Articles récents',
        'top_keywords': 'Mots-clés populaires',
        'trending_topics': 'Sujets tendance',
        'source_statistics': 'Statistiques des sources',
        'refresh_data': 'Actualiser les données',
        'last_updated': 'Dernière mise à jour',
        'no_articles': 'Aucun article trouvé. Essayez de sélectionner d\'autres sources.',
        
        // Sources page
        'select_sources': 'Sélectionner les sources',
        'fetch_data': 'Récupérer les données',
        'arxiv_settings': 'Paramètres ArXiv',
        'category': 'Catégorie',
        'max_articles': 'Nombre max d\'articles',
        'citation_styles': 'Styles de citation',
        'results': 'Résultats',
        'status': 'Statut',
        'no_sources_selected': 'Veuillez sélectionner au moins une source.',
        'fetching_data': 'Récupération des données, veuillez patienter...',
        'data_fetched': 'Données récupérées avec succès',
        
        // Chat
        'type_message': 'Tapez votre message...',
        'send': 'Envoyer',
        'clear_chat': 'Effacer la discussion',
        'export_chat': 'Exporter',
        'ai_welcome': 'Bonjour ! Je suis votre assistant de recherche IA. Je peux vous aider à analyser des articles de recherche, à trouver des connexions entre concepts, à résumer des articles et à répondre à des questions sur le contenu de votre base de données de recherche.'
    },
    
    // Spanish translations
    'es': {
        // Common UI elements
        'app_name': 'Herramienta de Investigación IA',
        'dashboard': 'Panel',
        'sources': 'Fuentes',
        'settings': 'Configuración',
        'chat': 'Chat',
        'loading': 'Cargando...',
        'save': 'Guardar',
        'cancel': 'Cancelar',
        'reset': 'Reiniciar',
        'search': 'Buscar',
        'more': 'Más',
        'less': 'Menos',
        'success': 'Éxito',
        'error': 'Error',
        'warning': 'Advertencia',
        'info': 'Información',
        
        // Settings page
        'general_settings': 'Configuración General',
        'source_settings': 'Configuración de Fuentes',
        'api_keys': 'Claves API',
        'notifications': 'Notificaciones',
        'export_settings': 'Configuración de Exportación',
        'advanced_settings': 'Configuración Avanzada',
        'application_theme': 'Tema de Aplicación',
        'language': 'Idioma',
        'date_format': 'Formato de Fecha',
        'enable_auto_refresh': 'Activar actualización automática (cada 30 minutos)',
        'save_settings': 'Guardar Configuración',
        'reset_all': 'Reiniciar Todo',
        'theme_light': 'Claro',
        'theme_dark': 'Oscuro',
        'theme_system': 'Por Defecto del Sistema',
        'reset_confirm': '¿Estás seguro de que quieres reiniciar todos los ajustes a los valores predeterminados? Esta acción no se puede deshacer.',
        'settings_saved': '¡Configuración guardada con éxito!',
        'all_settings_reset': 'Todos los ajustes se han reiniciado a los valores predeterminados',
        
        // Dashboard
        'recent_articles': 'Artículos Recientes',
        'top_keywords': 'Palabras Clave Principales',
        'trending_topics': 'Temas Tendencia',
        'source_statistics': 'Estadísticas de Fuentes',
        'refresh_data': 'Actualizar Datos',
        'last_updated': 'Última actualización',
        'no_articles': 'No se encontraron artículos. Intenta seleccionar diferentes fuentes.',
        
        // Sources page
        'select_sources': 'Seleccionar Fuentes',
        'fetch_data': 'Obtener Datos',
        'arxiv_settings': 'Configuración de ArXiv',
        'category': 'Categoría',
        'max_articles': 'Máximo de Artículos',
        'citation_styles': 'Estilos de Cita',
        'results': 'Resultados',
        'status': 'Estado',
        'no_sources_selected': 'Por favor, selecciona al menos una fuente.',
        'fetching_data': 'Obteniendo datos, por favor espera...',
        'data_fetched': 'Datos obtenidos con éxito',
        
        // Chat
        'type_message': 'Escribe tu mensaje...',
        'send': 'Enviar',
        'clear_chat': 'Limpiar Chat',
        'export_chat': 'Exportar',
        'ai_welcome': '¡Hola! Soy tu asistente de investigación con IA. Puedo ayudarte a analizar trabajos de investigación, encontrar conexiones entre conceptos, resumir artículos y responder preguntas sobre el contenido de tu base de datos de investigación.'
    },
    
    // Chinese translations (simplified)
    'zh': {
        // Common UI elements
        'app_name': 'AI研究工具',
        'dashboard': '仪表板',
        'sources': '资源',
        'settings': '设置',
        'chat': '聊天',
        'loading': '加载中...',
        'save': '保存',
        'cancel': '取消',
        'reset': '重置',
        'search': '搜索',
        'more': '更多',
        'less': '更少',
        'success': '成功',
        'error': '错误',
        'warning': '警告',
        'info': '信息',
        
        // Settings page
        'general_settings': '通用设置',
        'source_settings': '资源设置',
        'api_keys': 'API密钥',
        'notifications': '通知',
        'export_settings': '导出设置',
        'advanced_settings': '高级设置',
        'application_theme': '应用主题',
        'language': '语言',
        'date_format': '日期格式',
        'enable_auto_refresh': '启用自动刷新（每30分钟）',
        'save_settings': '保存设置',
        'reset_all': '重置全部',
        'theme_light': '亮色',
        'theme_dark': '暗色',
        'theme_system': '系统默认',
        'reset_confirm': '确定要将所有设置重置为默认值吗？此操作无法撤销。',
        'settings_saved': '设置保存成功！',
        'all_settings_reset': '所有设置已重置为默认值',
        
        // Dashboard
        'recent_articles': '最近文章',
        'top_keywords': '热门关键词',
        'trending_topics': '热门话题',
        'source_statistics': '资源统计',
        'refresh_data': '刷新数据',
        'last_updated': '最后更新',
        'no_articles': '未找到文章。请尝试选择不同的资源。',
        
        // Sources page
        'select_sources': '选择资源',
        'fetch_data': '获取数据',
        'arxiv_settings': 'ArXiv设置',
        'category': '分类',
        'max_articles': '最大文章数',
        'citation_styles': '引用样式',
        'results': '结果',
        'status': '状态',
        'no_sources_selected': '请至少选择一个资源。',
        'fetching_data': '正在获取数据，请稍候...',
        'data_fetched': '数据获取成功',
        
        // Chat
        'type_message': '输入您的消息...',
        'send': '发送',
        'clear_chat': '清除聊天',
        'export_chat': '导出',
        'ai_welcome': '您好！我是您的AI研究助手。我可以帮助您分析研究论文，找到概念之间的联系，总结文章，以及回答有关研究数据库中内容的问题。'
    }
};

// Helper function to get a translation
function getTranslation(key, language = 'en') {
    // Default to English if the requested language doesn't exist
    if (!translations[language]) {
        language = 'en';
    }
    
    // Return the translated text or the key if not found
    return translations[language][key] || key;
}

// Initialize the translation system
function initTranslations() {
    // Get the current language from localStorage or default to English
    const currentLang = localStorage.getItem('language') || 'en';
    document.documentElement.lang = currentLang;
    
    // Apply translations to all elements with data-i18n attributes
    applyTranslations(currentLang);
}

// Apply translations to the page
function applyTranslations(language = 'en') {
    const elements = document.querySelectorAll('[data-i18n]');
    
    elements.forEach(element => {
        const key = element.getAttribute('data-i18n');
        const translation = getTranslation(key, language);
        
        // If the element has HTML content, preserve it
        if (element.innerHTML.includes('<')) {
            // Only replace text nodes
            const childNodes = element.childNodes;
            for (let i = 0; i < childNodes.length; i++) {
                if (childNodes[i].nodeType === 3) { // Text node
                    childNodes[i].nodeValue = translation;
                    break; // Assume the first text node is the one to translate
                }
            }
        } else {
            element.textContent = translation;
        }
        
        // For placeholders in input fields
        if (element.placeholder) {
            const placeholderKey = element.getAttribute('data-i18n-placeholder');
            if (placeholderKey) {
                element.placeholder = getTranslation(placeholderKey, language);
            }
        }
    });
}

// Update the language
function changeLanguage(language) {
    localStorage.setItem('language', language);
    document.documentElement.lang = language;
    applyTranslations(language);
}

// Initialize when the DOM is fully loaded
document.addEventListener('DOMContentLoaded', initTranslations);