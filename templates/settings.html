{% extends "layout.html" %}

{% block title %}Settings{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/translations.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize translations
        initTranslations();
        
        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);
                
                if (targetElement) {
                    // Highlight the clicked nav item
                    document.querySelectorAll('nav a').forEach(item => {
                        item.classList.remove('bg-blue-50', 'text-blue-700');
                        item.classList.add('hover:bg-gray-100', 'text-gray-700');
                    });
                    
                    this.classList.remove('hover:bg-gray-100', 'text-gray-700');
                    this.classList.add('bg-blue-50', 'text-blue-700');
                    
                    // Smooth scroll to the target
                    window.scrollTo({
                        top: targetElement.offsetTop - 20,
                        behavior: 'smooth'
                    });
                }
            });
        });
        
        // Load saved settings from localStorage
        loadSavedSettings();
        
        // Form submissions
        const forms = document.querySelectorAll('form');
        
        forms.forEach(form => {
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(form);
                const formObject = {};
                
                formData.forEach((value, key) => {
                    // Handle checkboxes
                    if (form.elements[key].type === 'checkbox') {
                        formObject[key] = form.elements[key].checked;
                    } else {
                        formObject[key] = value;
                    }
                });
                
                // Special handling for general settings
                if (form.id === 'general-settings-form') {
                    saveGeneralSettings(formObject);
                }
                
                // Special handling for source settings
                if (form.id === 'sources-settings-form') {
                    saveSourceSettings(formObject);
                }
                
                // Display success message
                showNotification(getTranslation('settings_saved', localStorage.getItem('language') || 'en'), 'success');
                
                console.log('Form data:', formObject);
            });
        });
        
        // Function to load saved settings from localStorage
        function loadSavedSettings() {
            try {
                // Theme
                const savedTheme = localStorage.getItem('theme') || 'light';
                const themeSelect = document.getElementById('theme');
                if (themeSelect) {
                    themeSelect.value = savedTheme;
                }
                
                // Language
                const savedLanguage = localStorage.getItem('language') || 'en';
                const languageSelect = document.getElementById('language');
                if (languageSelect) {
                    languageSelect.value = savedLanguage;
                }
                
                // Date format
                const savedDateFormat = localStorage.getItem('dateFormat') || 'MM/DD/YYYY';
                const dateFormatSelect = document.getElementById('date-format');
                if (dateFormatSelect) {
                    dateFormatSelect.value = savedDateFormat;
                }
                
                // Auto refresh
                const savedAutoRefresh = localStorage.getItem('autoRefresh') === 'true';
                const autoRefreshCheckbox = document.getElementById('auto-refresh');
                if (autoRefreshCheckbox) {
                    autoRefreshCheckbox.checked = savedAutoRefresh;
                }
                
                // Source settings
                const sourceToggles = {
                    'source-arxiv': 'arxiv',
                    'source-techcrunch': 'techcrunch',
                    'source-venturebeat': 'venturebeat',
                    'source-stanford': 'stanford',
                    'source-theverge': 'theverge',
                    'source-hackernews': 'thehackernews'
                };
                
                // Try to load source settings from localStorage
                try {
                    const sourcesState = localStorage.getItem('sourcesFormState');
                    if (sourcesState) {
                        const parsedState = JSON.parse(sourcesState);
                        const selectedSources = parsedState.selectedSources || [];
                        
                        // Update checkboxes based on selected sources
                        Object.entries(sourceToggles).forEach(([checkboxId, sourceName]) => {
                            const checkbox = document.getElementById(checkboxId);
                            if (checkbox) {
                                checkbox.checked = selectedSources.includes(sourceName);
                            }
                        });
                    }
                } catch (err) {
                    console.error('Error loading source settings', err);
                }
            } catch (err) {
                console.error('Error loading settings', err);
            }
        }
        
        // Function to save general settings
        function saveGeneralSettings(settings) {
            try {
                // Handle theme setting
                const theme = settings.theme || 'light';
                localStorage.setItem('theme', theme);
                setTheme(theme);
                
                // Handle language setting
                const language = settings.language || 'en';
                localStorage.setItem('language', language);
                document.documentElement.lang = language;
                
                // Apply translations immediately when language is changed
                applyTranslations(language);
                
                // Handle date format
                localStorage.setItem('dateFormat', settings.date_format || 'MM/DD/YYYY');
                
                // Handle auto refresh
                localStorage.setItem('autoRefresh', settings.auto_refresh || false);
                
            } catch (err) {
                console.error('Error saving settings', err);
                showNotification(getTranslation('error', localStorage.getItem('language') || 'en'), 'error');
            }
        }
        
        // Function to save source settings
        function saveSourceSettings(settings) {
            try {
                // Create an array of enabled sources
                const selectedSources = [];
                
                if (settings.source_arxiv) selectedSources.push('arxiv');
                if (settings.source_techcrunch) selectedSources.push('techcrunch');
                if (settings.source_venturebeat) selectedSources.push('venturebeat');
                if (settings.source_stanford) selectedSources.push('stanford');
                if (settings.source_theverge) selectedSources.push('theverge');
                if (settings.source_hackernews) selectedSources.push('thehackernews');
                
                // Save to localStorage
                const currentState = {
                    selectedSources: selectedSources,
                    timestamp: new Date().getTime()
                };
                
                localStorage.setItem('sourcesFormState', JSON.stringify(currentState));
                
                // Refresh dashboard data
                const currentLang = localStorage.getItem('language') || 'en';
                
                fetch('/refresh-dashboard', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        sources: selectedSources
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        console.log('Dashboard refreshed with new source settings');
                    } else {
                        console.warn('Failed to refresh dashboard', data.message);
                    }
                })
                .catch(error => {
                    console.error('Error refreshing dashboard', error);
                });
                
            } catch (err) {
                console.error('Error saving source settings', err);
                showNotification(getTranslation('error', localStorage.getItem('language') || 'en'), 'error');
            }
        }
        
        // Theme functions
        function setTheme(theme) {
            if (theme === 'dark' || (theme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }
        
        // Reset settings confirmation
        const resetButton = document.getElementById('reset-settings');
        if (resetButton) {
            resetButton.addEventListener('click', function() {
                const currentLang = localStorage.getItem('language') || 'en';
                if (confirm(getTranslation('reset_confirm', currentLang))) {
                    // Clear localStorage settings
                    const oldLang = localStorage.getItem('language') || 'en';
                    localStorage.removeItem('theme');
                    localStorage.removeItem('language');
                    localStorage.removeItem('dateFormat');
                    localStorage.removeItem('autoRefresh');
                    localStorage.removeItem('sourcesFormState');
                    
                    // Reset form values
                    document.getElementById('theme').value = 'light';
                    document.getElementById('language').value = 'en';
                    document.getElementById('date-format').value = 'MM/DD/YYYY';
                    document.getElementById('auto-refresh').checked = false;
                    
                    // Reset source checkboxes
                    document.querySelectorAll('input[id^="source-"]').forEach(checkbox => {
                        checkbox.checked = true;
                    });
                    
                    // Apply reset settings
                    document.documentElement.classList.remove('dark');
                    document.documentElement.lang = 'en';
                    
                    // Apply English translations
                    applyTranslations('en');
                    
                    showNotification(getTranslation('all_settings_reset', 'en'), 'info');
                }
            });
        }
        
        // Show/hide password
        const passwordToggleButtons = document.querySelectorAll('button[type="button"]');
        
        passwordToggleButtons.forEach(button => {
            if (button.querySelector('.fa-eye') || button.querySelector('.fa-eye-slash')) {
                button.addEventListener('click', function() {
                    const icon = this.querySelector('i');
                    const input = this.parentNode.querySelector('input');
                    
                    if (input.type === 'password') {
                        input.type = 'text';
                        icon.classList.remove('fa-eye');
                        icon.classList.add('fa-eye-slash');
                    } else {
                        input.type = 'password';
                        icon.classList.remove('fa-eye-slash');
                        icon.classList.add('fa-eye');
                    }
                });
            }
        });
        
        // Helper function to show notifications
        function showNotification(message, type = 'success') {
            // Create notification element if it doesn't exist
            let notification = document.getElementById('notification');
            if (!notification) {
                notification = document.createElement('div');
                notification.id = 'notification';
                notification.className = 'fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transition-all transform translate-x-full';
                document.body.appendChild(notification);
            }
            
            // Set styling based on notification type
            let bgColor, textColor, icon;
            switch (type) {
                case 'success':
                    bgColor = 'bg-green-100';
                    textColor = 'text-green-800';
                    icon = 'fa-check-circle';
                    break;
                case 'error':
                    bgColor = 'bg-red-100';
                    textColor = 'text-red-800';
                    icon = 'fa-exclamation-circle';
                    break;
                case 'warning':
                    bgColor = 'bg-yellow-100';
                    textColor = 'text-yellow-800';
                    icon = 'fa-exclamation-triangle';
                    break;
                case 'info':
                default:
                    bgColor = 'bg-blue-100';
                    textColor = 'text-blue-800';
                    icon = 'fa-info-circle';
                    break;
            }
            
            // Set content and styling
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg ${bgColor} ${textColor} flex items-center space-x-2 transition-all transform translate-x-0 max-w-md`;
            notification.innerHTML = `
                <i class="fas ${icon} text-lg"></i>
                <span>${message}</span>
            `;
            
            // Animate in
            notification.style.transition = 'all 0.3s ease-in-out';
            notification.style.transform = 'translateX(0)';
            
            // Automatically hide after 3 seconds
            setTimeout(() => {
                notification.style.transform = 'translateX(150%)';
                
                // Remove after animation completes
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
    });
</script>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-800 dark:text-white" data-i18n="settings">
            <i class="fas fa-cog text-blue-600 dark:text-blue-400 mr-2"></i> Settings
        </h1>
    </div>
    
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Sidebar -->
        <div class="lg:col-span-1">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 sticky top-8">
                <h2 class="text-lg font-medium mb-4 text-gray-800 dark:text-white">Categories</h2>
                <nav>
                    <ul class="space-y-2">
                        <li>
                            <a href="#general" class="block px-4 py-2 rounded-md bg-blue-50 dark:bg-blue-900 text-blue-700 dark:text-blue-300 font-medium">
                                <i class="fas fa-sliders-h mr-2"></i> <span data-i18n="general_settings">General</span>
                            </a>
                        </li>
                        <li>
                            <a href="#sources" class="block px-4 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300">
                                <i class="fas fa-rss mr-2"></i> <span data-i18n="sources">Sources</span>
                            </a>
                        </li>
                        <li>
                            <a href="#api-keys" class="block px-4 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300">
                                <i class="fas fa-key mr-2"></i> <span data-i18n="api_keys">API Keys</span>
                            </a>
                        </li>
                        <li>
                            <a href="#notifications" class="block px-4 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300">
                                <i class="fas fa-bell mr-2"></i> <span data-i18n="notifications">Notifications</span>
                            </a>
                        </li>
                        <li>
                            <a href="#export" class="block px-4 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300">
                                <i class="fas fa-file-export mr-2"></i> <span data-i18n="export_settings">Export Settings</span>
                            </a>
                        </li>
                        <li>
                            <a href="#advanced" class="block px-4 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300">
                                <i class="fas fa-tools mr-2"></i> <span data-i18n="advanced_settings">Advanced</span>
                            </a>
                        </li>
                    </ul>
                </nav>
                
                <hr class="my-6 border-gray-200 dark:border-gray-700">
                
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-500 dark:text-gray-400">Version 2.0.0</span>
                    <button id="reset-settings" class="text-sm text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300" data-i18n="reset_all">
                        Reset All
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="lg:col-span-2 space-y-8">
            <!-- General Settings -->
            <section id="general" class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-6 flex items-center text-gray-800 dark:text-white">
                    <i class="fas fa-sliders-h text-blue-600 dark:text-blue-400 mr-2"></i> <span data-i18n="general_settings">General Settings</span>
                </h2>
                
                <form id="general-settings-form" class="space-y-6">
                    <div>
                        <label for="theme" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" data-i18n="application_theme">Application Theme</label>
                        <select id="theme" name="theme" class="block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                            <option value="light" data-i18n="theme_light">Light</option>
                            <option value="dark" data-i18n="theme_dark">Dark</option>
                            <option value="system" data-i18n="theme_system">System Default</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="language" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" data-i18n="language">Language</label>
                        <select id="language" name="language" class="block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                            <option value="en">English</option>
                            <option value="de">Deutsch</option>
                            <option value="fr">Français</option>
                            <option value="es">Español</option>
                            <option value="zh">中文</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="date-format" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" data-i18n="date_format">Date Format</label>
                        <select id="date-format" name="date_format" class="block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                            <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                            <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                            <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                        </select>
                    </div>
                    
                    <div class="flex items-center">
                        <input id="auto-refresh" name="auto_refresh" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded">
                        <label for="auto-refresh" class="ml-2 block text-sm text-gray-900 dark:text-gray-300" data-i18n="enable_auto_refresh">
                            Enable auto-refresh for data (every 30 minutes)
                        </label>
                    </div>
                    
                    <div>
                        <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" data-i18n="save_settings">
                            Save Settings
                        </button>
                    </div>
                </form>
            </section>
            
            <!-- Sources Settings -->
            <section id="sources" class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-6 flex items-center text-gray-800 dark:text-white">
                    <i class="fas fa-rss text-blue-600 dark:text-blue-400 mr-2"></i> <span data-i18n="source_settings">Source Settings</span>
                </h2>
                
                <form id="sources-settings-form" class="space-y-6">
                    <div class="space-y-4">
                        <h3 class="text-lg font-medium text-gray-900 dark:text-white">Enable/Disable Sources</h3>
                        
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <input id="source-arxiv" name="source_arxiv" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded" checked>
                                <label for="source-arxiv" class="ml-2 block text-sm text-gray-900 dark:text-gray-300">
                                    ArXiv Papers
                                </label>
                            </div>
                            <div>
                                <button type="button" class="text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300">
                                    Configure
                                </button>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <input id="source-techcrunch" name="source_techcrunch" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded" checked>
                                <label for="source-techcrunch" class="ml-2 block text-sm text-gray-900 dark:text-gray-300">
                                    TechCrunch
                                </label>
                            </div>
                            <div>
                                <button type="button" class="text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300">
                                    Configure
                                </button>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <input id="source-venturebeat" name="source_venturebeat" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded" checked>
                                <label for="source-venturebeat" class="ml-2 block text-sm text-gray-900 dark:text-gray-300">
                                    VentureBeat
                                </label>
                            </div>
                            <div>
                                <button type="button" class="text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300">
                                    Configure
                                </button>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <input id="source-stanford" name="source_stanford" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded" checked>
                                <label for="source-stanford" class="ml-2 block text-sm text-gray-900 dark:text-gray-300">
                                    Stanford AI Blog
                                </label>
                            </div>
                            <div>
                                <button type="button" class="text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300">
                                    Configure
                                </button>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <input id="source-theverge" name="source_theverge" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded" checked>
                                <label for="source-theverge" class="ml-2 block text-sm text-gray-900 dark:text-gray-300">
                                    The Verge
                                </label>
                            </div>
                            <div>
                                <button type="button" class="text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300">
                                    Configure
                                </button>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <input id="source-hackernews" name="source_hackernews" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded" checked>
                                <label for="source-hackernews" class="ml-2 block text-sm text-gray-900 dark:text-gray-300">
                                    The Hacker News
                                </label>
                            </div>
                            <div>
                                <button type="button" class="text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300">
                                    Configure
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            Save Source Settings
                        </button>
                    </div>
                </form>
            </section>
            
            <!-- API Keys -->
            <section id="api-keys" class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-6 flex items-center text-gray-800 dark:text-white">
                    <i class="fas fa-key text-blue-600 dark:text-blue-400 mr-2"></i> API Keys
                </h2>
                
                <form id="api-keys-form" class="space-y-6">
                    <div>
                        <label for="openai-key" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">OpenAI API Key</label>
                        <div class="mt-1 flex rounded-md shadow-sm">
                            <input type="password" name="openai_key" id="openai-key" class="flex-1 min-w-0 block w-full px-3 py-2 rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-blue-500 focus:ring-blue-500 sm:text-sm" placeholder="sk-...">
                            <button type="button" class="inline-flex items-center px-3 py-2 border border-l-0 border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 text-gray-700 dark:text-gray-300 sm:text-sm">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
                            Used for AI summarization and chat functionality
                        </p>
                    </div>
                    
                    <div>
                        <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            Save API Keys
                        </button>
                    </div>
                </form>
            </section>
            
            <!-- Notifications -->
            <section id="notifications" class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-6 flex items-center text-gray-800 dark:text-white">
                    <i class="fas fa-bell text-blue-600 dark:text-blue-400 mr-2"></i> Notifications
                </h2>
                
                <form id="notifications-form" class="space-y-6">
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <input id="notify-new-articles" name="notify_new_articles" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" checked>
                                <label for="notify-new-articles" class="ml-2 block text-sm text-gray-900 dark:text-gray-300">
                                    New articles found
                                </label>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <input id="notify-trending" name="notify_trending" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" checked>
                                <label for="notify-trending" class="ml-2 block text-sm text-gray-900 dark:text-gray-300">
                                    Trending topics
                                </label>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <input id="notify-system" name="notify_system" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <label for="notify-system" class="ml-2 block text-sm text-gray-900 dark:text-gray-300">
                                    System notifications
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label for="notification-frequency" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Notification Frequency</label>
                        <select id="notification-frequency" name="notification_frequency" class="block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                            <option value="immediate">Immediate</option>
                            <option value="hourly" selected>Hourly Digest</option>
                            <option value="daily">Daily Digest</option>
                            <option value="weekly">Weekly Digest</option>
                        </select>
                    </div>
                    
                    <div>
                        <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            Save Notification Settings
                        </button>
                    </div>
                </form>
            </section>
            
            <!-- Export Settings -->
            <section id="export" class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-6 flex items-center text-gray-800 dark:text-white">
                    <i class="fas fa-file-export text-blue-600 dark:text-blue-400 mr-2"></i> Export Settings
                </h2>
                
                <form id="export-settings-form" class="space-y-6">
                    <div>
                        <label for="citation-style" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Default Citation Style</label>
                        <select id="citation-style" name="citation_style" class="block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                            <option value="apa" selected>APA</option>
                            <option value="mla">MLA</option>
                            <option value="chicago">Chicago</option>
                            <option value="ieee">IEEE</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="export-format" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Default Export Format</label>
                        <select id="export-format" name="export_format" class="block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                            <option value="docx" selected>Microsoft Word (.docx)</option>
                            <option value="pdf">PDF Document</option>
                            <option value="txt">Plain Text</option>
                            <option value="json">JSON</option>
                        </select>
                    </div>
                    
                    <div class="flex items-center">
                        <input id="include-abstracts" name="include_abstracts" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded" checked>
                        <label for="include-abstracts" class="ml-2 block text-sm text-gray-900 dark:text-gray-300">
                            Include abstracts in exports
                        </label>
                    </div>
                    
                    <div class="flex items-center">
                        <input id="include-images" name="include_images" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded" checked>
                        <label for="include-images" class="ml-2 block text-sm text-gray-900 dark:text-gray-300">
                            Include images in exports
                        </label>
                    </div>
                    
                    <div>
                        <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            Save Export Settings
                        </button>
                    </div>
                </form>
            </section>
            
            <!-- Advanced Settings -->
            <section id="advanced" class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-6 flex items-center text-gray-800 dark:text-white">
                    <i class="fas fa-tools text-blue-600 dark:text-blue-400 mr-2"></i> Advanced Settings
                </h2>
                
                <form id="advanced-settings-form" class="space-y-6">
                    <div>
                        <label for="cache-duration" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Cache Duration (hours)</label>
                        <input type="number" name="cache_duration" id="cache-duration" value="24" min="1" max="168" class="block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
                            How long to cache data before refreshing (1-168 hours)
                        </p>
                    </div>
                    
                    <div>
                        <label for="max-articles" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Maximum Articles Per Source</label>
                        <input type="number" name="max_articles" id="max-articles" value="10" min="1" max="50" class="block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
                            Maximum number of articles to fetch per source (1-50)
                        </p>
                    </div>
                    
                    <div>
                        <label for="relevance-threshold" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Relevance Threshold</label>
                        <input type="range" name="relevance_threshold" id="relevance-threshold" min="0" max="100" value="50" step="5" class="range-slider w-full">
                        <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400">
                            <span>Low (Include More)</span>
                            <span>High (More Selective)</span>
                        </div>
                        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
                            Minimum relevance score for including articles
                        </p>
                    </div>
                    
                    <div class="flex items-center">
                        <input id="debug-mode" name="debug_mode" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded">
                        <label for="debug-mode" class="ml-2 block text-sm text-gray-900 dark:text-gray-300">
                            Enable debug mode
                        </label>
                    </div>
                    
                    <div>
                        <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            Save Advanced Settings
                        </button>
                    </div>
                </form>
            </section>
        </div>
    </div>
</div>
{% endblock %}